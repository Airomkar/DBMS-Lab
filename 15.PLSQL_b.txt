Questio --a) Write an SQL code block these raise a user defined exception where business rule is 
voilated. BR for client_ master table specifies when the value of  bal_due field is less than 0 
handle the exception. 

b) Write an SQL code block 
    Borrow(Roll_no, Name, DateofIssue, NameofBook, Status) 
    Fine(Roll_no,Date,Amt) 
Accept roll_no & name of book from user. Check the number of days (from date of issue), if 
days are between 15 to 30 then fine amount will be Rs 5per day. If no. of days>30, per day fine 
will be Rs 50 per day & for days less than 30, Rs. 5 per day. After submitting the book, status 
will change from I to R. If condition of fine is true, then details will be stored into fine table. 
Also handles the exception by named exception handler or user define exception handler. 

Solution--

Excellent â€” this is a PL/SQL practical exam question, and you need both:
âœ… he complete PL/SQL answers (for both a & b)
âœ… Possible oral viva questions with answers

Letâ€™s do both clearly and exam-ready ðŸ‘‡

---

ðŸ§© (a) User Defined Exception â€“ Business Rule Violation

Question Summary:

We have a table:
`Client_Master(Client_No, Name, Bal_Due)`
Business Rule (BR):

> When `Bal_Due < 0`, it violates the rule â†’ raise a user-defined exception.

---

âœ… PL/SQL Code


DECLARE
    v_clientno   Client_Master.Client_No%TYPE;
    v_bal        Client_Master.Bal_Due%TYPE;
    e_negative_balance EXCEPTION;  -- user-defined exception
BEGIN
    -- Take input from user
    v_clientno := &Enter_Client_No;

    -- Get balance due for entered client
    SELECT Bal_Due INTO v_bal 
    FROM Client_Master
    WHERE Client_No = v_clientno;

    -- Check business rule
    IF v_bal < 0 THEN
        RAISE e_negative_balance;
    ELSE
        DBMS_OUTPUT.PUT_LINE('Balance is valid. No business rule violated.');
    END IF;

EXCEPTION
    WHEN e_negative_balance THEN
        DBMS_OUTPUT.PUT_LINE('Business Rule Violation: Balance due cannot be negative.');
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('Invalid Client Number. Record not found.');
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Unexpected error: ' || SQLERRM);
END;
/


---

ðŸ§  Explanation

* We declared a **user-defined exception** `e_negative_balance`.
* Itâ€™s raised when `Bal_Due` is less than zero.
* `DBMS_OUTPUT` displays appropriate messages.
* Other exceptions (`NO_DATA_FOUND`) are also handled.

---

ðŸŽ¤ Oral Viva Questions (with Answers)

| **Question**                                   | **Answer**                                                                                                            |
| ---------------------------------------------- | --------------------------------------------------------------------------------------------------------------------- |
| 1. What is the business rule in this block?    | The balance due (Bal_Due) of a client cannot be negative.                                                             |
| 2. What happens when `Bal_Due` < 0?            | A user-defined exception is raised showing "Business Rule Violation".                                                 |
| 3. What is a user-defined exception?           | Itâ€™s a custom exception created by the programmer for a specific rule or condition not covered by default exceptions. |
| 4. How do we declare a user-defined exception? | Using `exception_name EXCEPTION;`                                                                                     |
| 5. How is a user-defined exception raised?     | By using the `RAISE` statement. Example: `RAISE e_negative_balance;`                                                  |
| 6. What is the use of `NO_DATA_FOUND` here?    | It handles the case when the entered client number does not exist in the table.                                       |
| 7. Why use `SQLERRM`?                          | It displays the actual error message generated by the system.                                                         |

---

ðŸ“˜ (b) Borrow & Fine Table â€“ Fine Calculation and Exception Handling

Tables:

1. **Borrow(Roll_no, Name, DateOfIssue, NameOfBook, Status)**
2. **Fine(Roll_no, Date, Amt)**

---

Question Logic

* Accept `Roll_no` and `NameOfBook` from user.
* Find the number of days between `DateOfIssue` and current date.
* Rules:

  * If days â‰¤ 15 â†’ no fine
  * If 15 < days â‰¤ 30 â†’ fine = â‚¹5 per day
  * If days > 30 â†’ fine = â‚¹50 per day
* After submitting book:

  * Update `Status` from `'I'` (Issued) to `'R'` (Returned)
  * If fine > 0, insert record into `Fine` table.
* Handle exception (like no record found or invalid input).

---

âœ… PL/SQL Code


DECLARE
    v_rollno    Borrow.Roll_no%TYPE;
    v_book      Borrow.NameOfBook%TYPE;
    v_dateissue Borrow.DateOfIssue%TYPE;
    v_days      NUMBER;
    v_fine      NUMBER := 0;
    e_no_record EXCEPTION;
BEGIN
    v_rollno := &Enter_Roll_No;
    v_book   := '&Enter_Book_Name';

    -- Fetch issue date
    SELECT DateOfIssue INTO v_dateissue
    FROM Borrow
    WHERE Roll_no = v_rollno AND NameOfBook = v_book AND Status = 'I';

    -- Calculate days difference
    v_days := TRUNC(SYSDATE - v_dateissue);

    -- Fine calculation
    IF v_days <= 15 THEN
        v_fine := 0;
    ELSIF v_days BETWEEN 16 AND 30 THEN
        v_fine := v_days * 5;
    ELSE
        v_fine := v_days * 50;
    END IF;

    -- Update book status to Returned
    UPDATE Borrow
    SET Status = 'R'
    WHERE Roll_no = v_rollno AND NameOfBook = v_book;

    -- If fine applicable, insert record into Fine table
    IF v_fine > 0 THEN
        INSERT INTO Fine(Roll_no, Date, Amt)
        VALUES (v_rollno, SYSDATE, v_fine);
        DBMS_OUTPUT.PUT_LINE('Book returned with fine Rs. ' || v_fine);
    ELSE
        DBMS_OUTPUT.PUT_LINE('Book returned. No fine applicable.');
    END IF;

    COMMIT;

EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('No record found or book already returned.');
    WHEN e_no_record THEN
        DBMS_OUTPUT.PUT_LINE('Borrow record missing.');
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Unexpected error: ' || SQLERRM);
END;
/


---

ðŸ§  Explanation

* `TRUNC(SYSDATE - DateOfIssue)` â†’ calculates total days between issue and return.
* If fine > 0 â†’ record is inserted into `Fine` table.
* Book status is updated to `'R'` meaning returned.
* Handles exceptions like missing records.

---

ðŸŽ¤ Oral Viva Questions (with Answers)

| **Question**                                         | **Answer**                                                           |
| ---------------------------------------------------- | -------------------------------------------------------------------- |
| 1. What are the two tables used here?                | `Borrow` and `Fine` tables.                                          |
| 2. What does the â€˜Statusâ€™ field represent?           | It indicates whether the book is **Issued (I)** or **Returned (R)**. |
| 3. How is the number of days calculated?             | Using `SYSDATE - DateOfIssue`.                                       |
| 4. What is the fine calculation rule?                | 0 fine â‰¤15 days, â‚¹5/day for 16â€“30 days, â‚¹50/day for >30 days.        |
| 5. What happens after returning a book?              | The status changes to `'R'` and fine is recorded (if applicable).    |
| 6. Why use the `TRUNC()` function?                   | To remove the time part and get only whole days.                     |
| 7. Which exception is handled if no record is found? | `NO_DATA_FOUND` exception.                                           |
| 8. What happens if fine = 0?                         | Only the book status changes; no entry is made in the Fine table.    |
| 9. Why do we use COMMIT?                             | To save the update and insertion permanently in the database.        |
| 10. Can we create our own exception here?            | Yes, using a user-defined exception like `e_no_record`.              |

---

ðŸ§¾ Quick Summary Table

| Part | Concept                     | Key Feature                                         |
| ---- | --------------------------- | --------------------------------------------------- |
| (a)  | User-defined exception      | Checks business rule (Bal_Due < 0)                  |
| (b)  | Condition + date arithmetic | Calculates fine, updates status, handles exceptions |
